pipeline {
    
    agent any
    stages {
        stage("Checkout") {
            steps {

               checkout scm
        }
            
            
    }
        
        stage("update git"){
        steps{
            withCredentials([usernamePassword(credentialsId: 'github', passwordVariable: 'pass', usernameVariable: 'user')]) {
                  script {
                        env.encodedPass=URLEncoder.encode(pass, "UTF-8")
                    }
    

        sh 'git config user.email "${GITHUB_EMAIL}" '
        sh 'git config user.name "${GITHUB_USERNAME}" '
        sh "cat ./dev/deploy.yaml"
        echo "${DOCKERTAG}"
        sh "sed -i 's+image-registry.openshift-image-registry.svc:5000/dhanya-jenkins/node-client.*+image-registry.openshift-image-registry.svc:5000/dhanya-jenkins/node-client:${DOCKERTAG}+g' ./dev/deploy.yaml"
        sh "cat ./dev/deploy.yaml"
        sh "git add ."
        sh "git commit -m 'done by jenkins job node-app-update-pipeline-front' "
        sh  'git push https://$user:$encodedPass@github.com/$user/node-2-update.git HEAD:branch'
           }
        }
        }
        }
}
